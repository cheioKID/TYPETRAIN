DATA SEGMENT 
SUGGEST DB 'BETTER TURN ON THE CAPSLOCK$'
NOTICE DB 13,10,'PLEASE DEFINE THE LENGTH OF THE STR:$'
WRONGLEN DB 13,10,'TYPE IN AGAIN (0<=LENGTH<=99):$'
RATE DB 'CORRECT RATE:$'
TIME DB 'COST TIME:$'
CONFIRM DB 'CONINUE: (Y/N)? $'
THKS DB 13,10,'THANKS!! GOODBYE!!$'
STR1 DB 100 DUP(0)
LEN DB 0
REC DB 0
STR2 DB 0,100 DUP(0)

DATA ENDS
;-----------------------------------------------------
STACK SEGMENT
	DW 64 DUP(?)
STACK ENDS
;----------------------------------------------------
TYPETRAIN SEGMENT
  ASSUME CS:TYPETRAIN,DS:DATA,SS:STACK
START:	
	MOV AX,STACK
	MOV SS,AX
	MOV AX,DATA
	MOV DS,AX
	LEA DX,SUGGEST
	MOV AH,09H
	INT 21H
CONTINUE:
	LEA DX,NOTICE
	MOV AH,09H
	INT 21H
	
	
	
	CALL GETLEN 	;DOS输入长度
	CALL RAND 	;生成随机字符串
	CALL TYPEIN 	;输入字符串,回车结束,得出用时
	CALL ASK	;是否继续练习y/n,q退出
	
	
BYE:
	LEA DX,THKS
	MOV AH,09H
	INT 21H
	MOV AH,4CH
	INT 21H
	
;-----------------------------------------------------
GETLEN PROC NEAR
LENIN:	MOV AH,01H
	INT 21H
	SUB AL,30H	;AL存放长度的十位
	CMP AL,0
	JL WNOTICE
	CMP AL,9
	JG WNOTICE
	MOV BL,AL
	MOV CL,3
	SAL AL,CL
	SAL BL,1
	ADD BL,AL
	MOV AH,01H
	INT 21H
	SUB AL,30H	;长度的个位
	CMP AL,0
	JL WNOTICE
	CMP AL,9
	JG WNOTICE
	ADD AL,BL	;AL存放长度
	MOV LEN,AL
    JMP BETWEEN
    
WNOTICE:
	LEA DX,WRONGLEN	
	MOV AH,09H
	INT 21H
	JMP LENIN
	
BETWEEN:
	MOV DL,13
	MOV AH,02H  	;回车换行
	INT 21H
	MOV DL,10
	MOV AH,02H
	INT 21H
	RET

GETLEN ENDP
;-----------------------------------------------------	
RAND PROC NEAR 
	XOR AX,AX
	XOR CX,CX
	MOV CL,LEN
	LEA SI,STR1-1
PUTCHAR:
    	PUSH CX
	MOV AH,0H	    ;得到时钟计数器值到DX
	INT 1AH
	POP CX
	MOV AX,DX
	ROR DX,CL
	XOR AX,DX
	AND AX,00FFH
	MOV DL,26	    ;产生0~25随机数
	DIV DL
	ADD AH,41H	    ;A-Z的ASC码
	MOV DL,AH
	INC SI
	MOV [SI],AH
	MOV AH,02H
	INT 21H
	LOOP PUTCHAR
	
	MOV DL,13       ;回车换行
	MOV AH,02H
	INT 21H
	MOV DL,10
	MOV AH,02H
	INT 21H
	RET

RAND ENDP
;-----------------------------------------------------
TYPEIN PROC NEAR
	XOR AX,AX
	MOV CX,0
	MOV DX,0
    MOV AH,2CH		    ;取系统时间到CX,DX
	INT 21H
	PUSH CX
	PUSH DX
	INC BYTE PTR LEN    ;cr占一个字符,len+1
	LEA DX,LEN
	MOV AH,0AH
	INT 21H
	DEC BYTE PTR LEN
	MOV AH,2CH		    ;取系统时间到CX,DX
	INT 21H
	PUSH CX
	PUSH DX
	LEA SI,STR1
	DEC SI
	LEA DI,STR2
	DEC DI
	XOR CX,CX
	MOV CL,LEN
	XOR AX,AX
COMPARE:
	INC SI
	INC DI
	MOV AH,[SI]
	CMP AH,[DI]
	JNE SKIP
	INC AL			;AL存放相同的字符数量
SKIP:	
	ADD AL,0
	LOOP COMPARE 
	PUSH AX
	
	MOV DL,13       ;回车换行
	MOV AH,02H
	INT 21H
	MOV DL,10
	MOV AH,02H
	INT 21H
	
	LEA DX,RATE
	MOV AH,09H
	INT 21H
	POP AX		;正确率:正确字符数/长度
	AND AX,00FFH
	MOV CL,10
	DIV CL
	ADD AX,3030H
	PUSH AX
	MOV DL,AL
	MOV AH,02H
	INT 21H
	POP AX
	MOV DL,AH
	MOV AH,02H
	INT 21H
	MOV DL,'/'
	MOV AH,02H
	INT 21H
	XOR AX,AX
	MOV AL,LEN
	DIV CL
	ADD AX,3030H
	PUSH AX
	MOV DL,AL
	MOV AH,02H
	INT 21H
    	POP AX
    	MOV DL,AH
    	MOV AH,02H
    	INT 21H
    
    	MOV DL,' '       ;space
	MOV AH,02H
	INT 21H
	    
	LEA DX,TIME
	MOV AH,09H
	INT 21H
	POP BX			;CX时分,DX秒
	POP AX
	POP DX
	POP CX
	CMP BH,DH
	JAE SUBB
	SUB AL,1
	ADD BH,60
SUBB:
	SUB BH,DH
	SUB AL,CL
	MOV CL,10
	AND AX,00FFH
	DIV CL
	ADD AX,3030H
	PUSH AX
	MOV DL,AL
	MOV AH,02H
	INT 21H
	POP AX
	MOV DL,AH
	MOV AH,02H
	INT 21H
	MOV DL,':'
	MOV AH,02H
	INT 21H
	XOR AX,AX
	MOV AL,BH
	DIV CL
	ADD AX,3030H
	PUSH AX
	MOV DL,AL
	MOV AH,02H
	INT 21H
	POP AX
	MOV DL,AH
	MOV AH,02H
	INT 21H
	
	MOV DL,13       ;回车换行
	MOV AH,02H
	INT 21H
	MOV DL,10
	MOV AH,02H
	INT 21H
	RET

TYPEIN ENDP
;-------------------------------------------------------
ASK PROC NEAR
AGAIN:	
    	LEA DX,CONFIRM
	MOV AH,09H
	INT 21H
	

	MOV AH,01H
	INT 21H
	CMP AL,'Y'
	JE CONTINUE
	CMP AL,'N'
	JE BYE
	JNE AGAIN
	RET

ASK ENDP

TYPETRAIN ENDS
	END START

